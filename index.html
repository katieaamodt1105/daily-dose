<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Dose</title>

  <!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&family=Playfair+Display:ital,wght@0,500;1,500&family=Pacifico&display=swap" rel="stylesheet">

  <style>
    body {
  font-family: 'Montserrat', sans-serif;
  background: #f7f5f2;
  margin: 0;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}


    .card {
  background: #ffffff;
  max-width: 520px;
  width: 100%;
  padding: 2.75rem; /* slightly more breathing room */
  margin: 1rem;
  border-radius: 24px;
  box-shadow: 0 14px 40px rgba(0,0,0,0.08);
  text-align: center;
  animation: fadeUp 0.6s ease-out;
}

    .date {
  font-family: 'Pacifico', cursive;
  font-size: 1.6rem;
  color: #5f5f5f;
  margin-bottom: 2.75rem;
  transform: rotate(-1deg);
}

    .date::after {
  content: " ‚ú®";
}

    .text-content {
      font-size: 1rem;
      line-height: 1.9;
      margin-bottom: 1.5rem;
    }

    .photo-wrapper {
      position: relative;
      border-radius: 24px;
      overflow: hidden;
      margin-bottom: 0.75rem;
    }

    .photo-wrapper {
  border-radius: 18px;
  overflow: hidden;
  margin-bottom: 0.75rem;
}


   img {
  width: 100%;
  max-height: 65vh; /* fits nicely on mobile screens */
  object-fit: contain; /* NO cropping */
  display: none;
  border-radius: 18px;
  margin: 0 auto;
}



    .photo-meta {
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #999;
      margin-bottom: 1.25rem;
      display: none;
    }

    iframe {
      margin-top: 1rem;
      border-radius: 14px;
      display: none;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .lyric {
  font-family: 'Montserrat', serif;
  font-size: 1rem;
  line-height: 1.9;
  font-style: italic;
}
    .divider {
  width: 40px;
  height: 4px;
  border-radius: 999px;
  background: rgba(0,0,0,0.08);
  margin: 0 auto 2rem;
}
.birthday-overlay {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 999;
}

.birthday-text {
  font-family: 'Pacifico', cursive;
  font-size: clamp(3rem, 10vw, 6rem);
  color: #ff6f61;
  animation: popIn 0.8s ease-out forwards,
             float 2s ease-in-out infinite;
  text-align: center;
}

@keyframes popIn {
  from {
    transform: scale(0.6);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.confetti {
  position: fixed;
  width: 8px;
  height: 12px;
  background: hsl(var(--hue), 90%, 65%);
  top: -10px;
  animation: fall linear forwards;
  z-index: 998;
}

@keyframes fall {
  to {
    transform: translateY(110vh) rotate(720deg);
  }
}


  </style>
</head>

<body>
  <main class="card">
    <div id="date" class="date">Your daily dose ‚òïÔ∏è</div>
    <div class="divider"></div>


    <p id="content" class="text-content"></p>

    <div class="photo-wrapper">
      <img id="image" />
    </div>

    <p id="photo-meta" class="photo-meta">A picture's worth a thousand words</p>
<iframe
  id="gif"
  width="100%"
  height="280"
  frameborder="0"
  allowfullscreen
  style="display:none; border-radius:18px;">
</iframe>

    <iframe
      id="spotify"
      width="100%"
      height="152"
      frameborder="0"
      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
    </iframe>
  </main>

  <script>
/* =========================
   CONFIG
========================= */
const SHEET_ID = "1E9gjeth0nx2iel6OWRpkDVdxUlqRrZJW8r6-zQky4aw";
const SHEET_NAME = "Daily Dose";

/* =========================
   HELPERS
========================= */
function getPreviewType() {
  const params = new URLSearchParams(window.location.search);
  const preview = params.get("preview");
  return preview ? preview.toLowerCase().trim() : null;
}

function formatDate(date) {
  return date.toLocaleDateString(undefined, {
    weekday: "long",
    month: "long",
    day: "numeric"
  });
}

function launchBirthday() {
  const overlay = document.createElement("div");
  overlay.className = "birthday-overlay";

  const text = document.createElement("div");
  text.className = "birthday-text";
  text.innerText = "HAPPY BIRTHDAY! üéâ";

  overlay.appendChild(text);
  document.body.appendChild(overlay);

  for (let i = 0; i < 120; i++) {
    const piece = document.createElement("div");
    piece.className = "confetti";
    piece.style.left = Math.random() * 100 + "vw";
    piece.style.animationDuration = 3 + Math.random() * 3 + "s";
    piece.style.setProperty("--hue", Math.random() * 360);
    document.body.appendChild(piece);

    setTimeout(() => piece.remove(), 6000);
  }
}

/* =========================
   FETCH SHEET
========================= */
const query = encodeURIComponent("SELECT A,B,C,D,E");
const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${SHEET_NAME}&tq=${query}`;

fetch(url)
  .then(res => res.text())
  .then(text => {
    const jsonText = text.substring(
      text.indexOf("{"),
      text.lastIndexOf("}") + 1
    );
    const json = JSON.parse(jsonText);
    const rows = json.table.rows;

    if (!rows || rows.length === 0) {
      throw new Error("No rows returned from sheet");
    }

    /* =========================
       ELEMENTS
    ========================= */
    const dateEl = document.getElementById("date");
    const contentEl = document.getElementById("content");
    const imgEl = document.getElementById("image");
    const metaEl = document.getElementById("photo-meta");
    const gifEl = document.getElementById("gif");
    const spotifyEl = document.getElementById("spotify");

    /* =========================
       DATE + BIRTHDAY
    ========================= */
    const today = new Date();
    const todayMonth = today.getMonth();
    const todayDay = today.getDate();

    dateEl.innerText = formatDate(today);

    if (todayMonth === 5 && todayDay === 21) {
      launchBirthday();
    }

    /* =========================
       ROW MATCHING
    ========================= */
    let match = rows.find(r => {
      if (!r.c || !r.c[0] || !r.c[0].v) return false;
      const d = new Date(r.c[0].v);
      return d.getMonth() === todayMonth && d.getDate() === todayDay;
    }) || rows[todayDay % rows.length];

    const previewType = getPreviewType();
    const sourceRow = previewType
      ? rows.find(r => {
          const cell = r.c?.[1]?.v;
          return cell && String(cell).toLowerCase().trim() === previewType;
        })
      : match;

    if (!sourceRow || !sourceRow.c) {
      throw new Error("No matching row found");
    }

    /* =========================
       DATA
    ========================= */
    const type = (sourceRow.c[1]?.v || "").toLowerCase().trim();
    const content = sourceRow.c[2]?.v || "";
    const imageUrl = sourceRow.c[3]?.v;
    const spotifyUrl = sourceRow.c[4]?.v;

    /* =========================
       RESET VISIBILITY
    ========================= */
    contentEl.style.display = "none";
    imgEl.style.display = "none";
    metaEl.style.display = "none";
    gifEl.style.display = "none";
    spotifyEl.style.display = "none";

    /* =========================
       TEXT CONTENT
    ========================= */
    const textTypes = ["affirmation", "quote", "fortune", "funny"];
    if (textTypes.includes(type)) {
      contentEl.innerText = content;
      contentEl.style.display = "block";
    }

    /* =========================
       IMAGES / GIFS
    ========================= */
    if (imageUrl) {
      if (imageUrl.includes("tenor.com/embed")) {
        gifEl.src = imageUrl;
        gifEl.style.display = "block";
      } else {
        imgEl.src = imageUrl;
        imgEl.style.display = "block";
        metaEl.style.display = "block";
      }
    }

    /* =========================
       SPOTIFY
    ========================= */
    if (type === "lyric" && spotifyUrl) {
      contentEl.innerText = content;
      contentEl.classList.add("lyric");
      contentEl.style.display = "block";

      spotifyEl.src = spotifyUrl.includes("/embed/")
        ? spotifyUrl
        : spotifyUrl.replace(
            "https://open.spotify.com/",
            "https://open.spotify.com/embed/"
          );

      spotifyEl.style.display = "block";
    }
  })
  .catch(err => {
    document.getElementById("content").innerText = "Error loading content.";
    console.error(err);
  });
</script>

</body>
</html>
